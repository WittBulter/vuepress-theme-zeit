# 发布的实践

这是一些经验和实践之谈，仅仅是推荐。如果你想，完全可以跳过此节，按自己喜欢的方式发布。

## 打包与发布包

目前在 `func` 的模板项目中包含了工具 `func-service`，使用它可以一键将你的命令打包成单个文件。大部分情况下你只需要运行一个命令就可以完成打包工作：

```ts
npm build
```

随后只需要运行 `npm publish` 即可将包发布至 NPM，如果你在使用其他包管理平台，将 `dist` 文件夹发布出去即可。

在极少的场景里，你的代码中包含了动态字符串的引入包方式 (如 `require(${var}something${version})`)，这可能会使打包失败，因为 bundle 工具无法
正确的识别文件位置，只有在代码运行时才能确定包名。面对这种情况你有几个选择:

- 替换成静态包名 (最好的选择)
- 手动检查路径，并将所有依赖的动态包移入 `dist`
- 自己编写一个动态的 webpack 打包脚本

## 发布更少的文件

我们知道大多数命令行工具使用时，除了运行速度以外，安装速度也是倍受关注的重点，学会如何减少包的下载时间会让你的用户获得更好的体验。

- 使用 `files` 约束。

  `package.json` 中的 `files` 选项是用于约束有多少文件可以被发布，正常情况下你只需要携带 `dist` 文件夹即可。类似于 `src` / `docs` 等等
这些文件在 bundle 后不会被实际运行，把它们一起发布出去对用户没有任何作用。

- 使用 HTTP 请求。

  在你面临一个大文件或配置时，可以考虑不引入它，而是通过 HTTP 去服务端请求加载，这会大大减少包的体积。当然这也取决于你的业务逻辑，自行斟琢。
  
- 不要使用过多依赖的包。

  有些第三方包只是完成了一个极其简单的功能，但体积惊人，在开发命令行工具时请注意这些包是否有过多的依赖，是否体积巨大等等。
  
- 试着将依赖移入 `devDependencies`。

  这是一个危险的行为，但在 `func` 构建的项目中却行之有效。这是因为 `func` 会把命令行所有文件打包在一起，在运行期间依赖也就失去了作用，把它们置入
开发依赖 `devDependencies` 中可以避免 NPM 在下载时对比依赖版本所消耗的时间。
  
  
  



